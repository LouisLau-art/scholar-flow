# Research: Editor Performance Refactor

## Scope

围绕以下问题做决策收敛：
- 审稿候选搜索短缓存如何设计，才能提速且不污染数据正确性。
- process/workspace 如何复用详情页的降载策略而不破坏现有交互。
- 改前/改后基线如何采样，如何接入发布门禁。

## Decision 1: 审稿候选搜索采用“会话级内存短缓存 + 请求去重”

**Decision**: 
- 在前端会话内为审稿候选搜索增加短缓存。
- 缓存键采用：`manuscript_id + normalized_query + viewer_role_scope + limit`。
- 默认 TTL 设为 20 秒；同键并发请求合并（inflight 去重）。
- 以下场景强制失效：稿件切换、弹窗关闭后超过 TTL、角色上下文变化、显式刷新。

**Rationale**:
- 搜索场景重复输入和反复开关弹窗频率高，短缓存可显著减少重复请求与体感等待。
- 20 秒可覆盖一次分配操作窗口，同时避免长期缓存导致陈旧风险。
- inflight 去重可避免慢网环境下的请求风暴。

**Alternatives considered**:
- 完全不缓存：实现简单，但重复查询成本高，体感卡顿无改善。
- 仅后端缓存：可降后端压力，但前端重复等待仍明显，无法优化输入阶段体验。
- 长 TTL（>60 秒）：命中率更高，但候选策略变化后陈旧风险不可接受。

## Decision 2: process/workspace 采用“核心列表优先 + 非核心延迟加载 + 局部刷新”

**Decision**:
- 复用详情页实践，将页面拆为核心可操作区与次要信息区。
- 核心区（列表、筛选、关键状态）优先返回与渲染。
- 次要区（扩展统计、附属信息）在可见或用户触发后加载。
- 用户动作后仅刷新受影响模块，避免整页 reload。

**Rationale**:
- 用户价值首先来自“可操作”，不是“全量数据一次到齐”。
- 局部刷新可缩短交互回路并减少无效请求。
- 与现有 `timeline-context` / `cards-context` 聚合思路一致，改造成本与风险可控。

**Alternatives considered**:
- 继续全量首屏加载：实现简单，但页面规模增长时长尾问题持续存在。
- 完全分页化拆页面：性能可提升，但改变用户行为路径，超出本次优化范围。

## Decision 3: 性能基线采用“统一样本 + 分层验证 + 发布门禁阈值”

**Decision**:
- 基线采样固定在预发布环境，使用同一批高负载样本稿件。
- 指标统一记录：
  - 首屏可操作时间（p50/p95）
  - 首屏请求数
  - 重复搜索响应时间占比
- 发布门禁规则：任一核心链路劣化超过 10%，或全量回归失败，则不得放行。
- 结果归档到当前 feature `specs` 目录，作为后续比对基准。

**Rationale**:
- 没有统一样本会导致“优化结果不可比较”。
- p95 与请求数可以同时反映用户体验和请求结构问题。
- 10% 劣化阈值可识别真实退化，同时避免过度敏感导致误阻断。

**Alternatives considered**:
- 仅看平均耗时：会掩盖长尾问题。
- 仅跑功能测试：无法识别性能回退。
- 无门禁仅人工判断：可追溯性弱，长期容易退化。

## Decision 4: 回归策略采用 Tier 1/2/3 分层执行

**Decision**:
- 开发中：定向回归（Tier 1）快速验证。
- 提交前：跑关联路径单元/集成（Tier 2）。
- 合并前：全量回归 + 覆盖率门槛 + 必要 E2E（Tier 3）。

**Rationale**:
- 符合宪法“效率与质量并重”原则，既保证速度又保证主干稳定。

**Alternatives considered**:
- 每次全量：质量高但迭代慢。
- 仅定向测试：速度快但回归风险高。

## Clarification Status

- 本特性在计划阶段无未决 `NEEDS CLARIFICATION` 项。
