# Feature Specification: Editor Performance Refactor

**Feature Branch**: `001-editor-performance-refactor`  
**Created**: 2026-02-24  
**Status**: Draft  
**Input**: User description: "为编辑端做系统性性能优化与重构：完成详情链路降载，扩展到 process/workspace，补齐 ReviewerAssignmentSearch 候选短缓存，并建立改前改后基线与全量回归门槛"

## User Scenarios & Testing *(mandatory)*

### User Story 1 - 编辑详情页快速可操作 (Priority: P1)

作为编辑角色（managing editor、assistant editor、editor-in-chief、admin），我希望打开稿件详情页后先快速看到并操作核心信息，而不是被非核心模块阻塞。

**Why this priority**: 详情页是编辑链路最频繁入口，首屏卡顿会直接影响分配审稿、内部协作和终审效率。

**Independent Test**: 在预发布环境中，针对“有时间线、有内部协作记录、有审稿数据”的典型稿件，单独验证详情页首屏可操作时长、首屏请求数和卡顿感知，无需依赖其他页面改造即可体现价值。

**Acceptance Scenarios**:

1. **Given** 目标稿件存在大量历史时间线与协作记录，**When** 编辑首次打开详情页，**Then** 核心区块应先进入可操作状态，非核心区块延后加载且不阻塞主操作。
2. **Given** 编辑已在详情页完成内部协作动作（评论、任务更新、状态变更），**When** 页面完成该动作后的刷新，**Then** 仅刷新受影响区块，不触发整页重载。

---

### User Story 2 - 审稿人分配与候选搜索响应稳定 (Priority: P2)

作为负责分配审稿人的编辑，我希望打开分配弹窗后再加载候选数据，搜索输入不过度触发查询，且短时间重复搜索可快速复用结果。

**Why this priority**: 审稿分配是高频动作，候选搜索抖动和重复请求会放大“卡顿”主观感受并拖慢分配节奏。

**Independent Test**: 在同一稿件下连续打开弹窗并重复输入相同关键词，观察首个结果出现时间、重复搜索响应时间和异常提示行为。

**Acceptance Scenarios**:

1. **Given** 编辑尚未打开分配弹窗，**When** 停留在稿件详情主界面，**Then** 系统不应提前拉取候选列表。
2. **Given** 编辑在弹窗中连续输入搜索关键词，**When** 输入停顿后触发搜索，**Then** 系统应避免一次按键一次查询，并返回稳定结果。
3. **Given** 编辑在短时间内重复同稿件同关键词搜索，**When** 再次搜索，**Then** 结果应明显快于首次搜索并保持一致性。

---

### User Story 3 - Process/Workspace 页面与性能基线可治理 (Priority: P3)

作为系统维护者，我希望把详情页的降载策略扩展到 process/workspace，并建立改前改后基线与回归门槛，让后续优化可量化、可持续。

**Why this priority**: 仅优化单页无法形成长期收益，缺少基线会导致后续回归时无法判断是否退化。

**Independent Test**: 独立执行 process/workspace 页面性能对比和全量回归门禁，不依赖新增业务功能即可验证。

**Acceptance Scenarios**:

1. **Given** 维护者执行一次完整性能验证，**When** 对比改前改后结果，**Then** 必须能看到可追溯的关键指标变化（页面可操作时间、请求数量、长尾表现）。
2. **Given** 准备发布优化版本，**When** 回归测试未通过或性能指标劣化超过门槛，**Then** 发布应被阻断并要求修复。

### Edge Cases

- 当网络抖动或后端接口超时时，页面应保留已可见数据并提供明确重试入口，而不是整页空白或无限加载。
- 当短缓存命中到过期或上下文变化（稿件切换、角色变化）时，应自动失效并拉取新结果，避免错用旧数据。
- 当数据量极大（时间线、评论、任务记录显著增长）时，页面仍应维持首屏先可操作、次要内容延后展示。
- 当同一编辑短时间频繁打开/关闭分配弹窗时，系统应避免请求风暴与重复加载提示。

## Requirements *(mandatory)*

### Functional Requirements

- **FR-001**: 系统必须将编辑详情页的数据加载拆分为“核心可操作信息优先”与“次要信息延后加载”两段，且次要信息不得阻塞核心操作。
- **FR-002**: 系统必须支持对非核心区块按需加载（用户主动展开或区块进入可见范围时触发），并在加载期间保持页面可交互。
- **FR-003**: 系统必须在内部协作动作完成后仅刷新受影响的数据区块，禁止默认触发整页详情重拉。
- **FR-004**: 系统必须把同等级降载策略覆盖到编辑流程列表页与编辑工作台页，确保筛选、搜索、列表更新不会因次要信息阻塞首屏。
- **FR-005**: 审稿人分配候选列表必须在弹窗打开后才开始加载，弹窗未打开时不得触发候选请求。
- **FR-006**: 候选搜索必须具备防抖行为，连续输入期间不应为每次按键发起独立查询。
- **FR-007**: 同一稿件上下文的相同候选搜索条件必须支持短时间结果复用（默认缓存 TTL 为 20 秒）；当上下文变化或缓存过期时必须自动失效。
- **FR-008**: 系统必须产出改前/改后性能基线记录，至少包含页面可操作时间、首屏请求数、关键长尾表现三个维度。
- **FR-009**: 系统必须定义发布门槛：若任一核心链路性能指标较基线劣化超过 10%，或全量回归未通过，则必须阻断发布。
- **FR-010**: 上述优化后，业务行为与权限边界必须保持一致，不能引入角色可见性、流程状态或审计信息回归。

### Key Entities *(include if feature involves data)*

- **页面性能基线记录 (Performance Baseline Record)**: 描述某页面在指定环境与数据样本下的核心体验指标，用于改前改后对比。
- **加载阶段快照 (Load Stage Snapshot)**: 描述页面从进入到可操作的阶段性状态，包括“首屏可操作”与“延后区块完成”。
- **候选搜索上下文 (Candidate Search Context)**: 由稿件、关键词、角色视角构成，用于判断搜索结果是否可复用。
- **回归门禁结果 (Regression Gate Result)**: 汇总性能对比与测试通过状态，用于发布放行决策。

### Assumptions

- 预发布环境可提供稳定、可重复的数据样本用于基线采集。
- 参与验证的角色覆盖至少 managing editor、assistant editor、editor-in-chief、admin。
- 业务流程口径（审稿邀请策略、权限边界、状态流转）在本次性能优化期内不发生规则变更。

## Success Criteria *(mandatory)*

### Measurable Outcomes

- **SC-001**: 编辑详情页在典型稿件样本下，95% 打开请求可在 3 秒内进入首屏可操作状态，且较当前基线至少提升 30%。
- **SC-002**: 编辑流程列表页与编辑工作台页在同等数据规模下，95% 的首次进入或刷新可在 2.5 秒内完成核心列表可操作。
- **SC-003**: 审稿人候选搜索在重复同条件查询场景下，95% 的重复查询响应时间不高于首次查询时间的 50%。
- **SC-004**: 发布前性能回归报告必须覆盖详情页、process、workspace 三条链路；若任一链路劣化超过 10%，发布判定为不通过。
- **SC-005**: 本次优化上线后连续 7 天内，编辑端“页面长时间转圈/加载过慢”相关反馈数量较优化前周期下降 50% 以上。
