# Feature Specification: ScholarFlow Core Workflow

**Feature Branch**: `001-core-workflow`  
**Created**: 2026-01-27  
**Status**: Draft  
**Input**: User description: "请编写 ScholarFlow 的核心需求规格说明书。包含以下用户故事： US1 (作者)：仿照 Frontiers 风格的首页。支持作者上传 PDF 投稿，AI 自动解析提取标题、摘要和作者信息并自动填表。 US2 (编辑)：编辑在后台对稿件进行质检，必须绑定“归属人（KPI）”。 US3 (审稿人)：审稿人通过邮件里的 Token 链接免登录进入系统，预览 PDF 并提交审稿报告。 US4 (财务)：稿件录入后自动生成 PDF 账单发送给作者，财务人工确认到账后，文章才允许点击“上线”。 US5 (AI 匹配)：利用 Python 后端的算法（TF-IDF 或语义向量），自动推荐匹配的审稿人。"

## Clarifications

### Session 2026-01-27
- Q: 当 AI 解析引擎完全无法提取 PDF 内容时，系统的 fallback 机制是什么？ → A: 允许作者手动填写所有字段。
- Q: 如果编辑在质检 (US2) 过程中发现稿件质量不合格，系统应如何处理？ → A: 退回给作者进行修改。
- Q: 审稿人的免登录 Token (US3) 应该如何生成及管理有效期？ → A: 系统自动生成随机 Token + 14天有效期。
- Q: 财务人员确认款项 (US4) 的具体交互方式是什么？ → A: 财务人员在后台手动确认。
- Q: AI 推荐审稿人 (US5) 后，系统如何执行下一步动作？ → A: 编辑从推荐列表中点击“邀请”发送。

## User Scenarios & Testing

### User Story 1 - 作者投稿与 AI 辅助解析 (Priority: P1)

作者访问系统首页，上传 PDF 格式的学术稿件。系统自动提取稿件的关键元数据并填充投稿表单。

**Why this priority**: 投稿是系统的入口，AI 解析能极大提升用户体验并减少手动录入错误。

**Independent Test**: 作者上传一个标准的学术 PDF，系统在 10 秒内显示解析出的标题、摘要和作者列表，作者核对无误后提交。

**Acceptance Scenarios**:
1. **Given** 作者登录首页，**When** 上传合法的 PDF 文件，**Then** 表单自动填入标题、摘要及作者信息。
2. **Given** AI 解析结果，**When** 作者修改解析错误的字段并点击提交，**Then** 系统保存修改后的数据。

---

### User Story 2 - 编辑质检与 KPI 归属 (Priority: P2)

编辑在管理后台查看待处理稿件，进行质量检查，并必须将稿件关联至具体的负责人以统计 KPI。

**Why this priority**: 确保稿件进入正式评审流程前的质量控制，并明确内部责任制。

**Independent Test**: 编辑选择一份稿件，勾选质检通过，选择一名 KPI 归属人，保存后稿件状态流转至“待指派审稿人”。

**Acceptance Scenarios**:
1. **Given** 待质检稿件列表，**When** 编辑提交质检结果但未选择归属人，**Then** 系统提示报错。
2. **Given** 质检通过并绑定归属人，**When** 提交保存，**Then** 稿件状态更新，且归属人记录不可修改。
3. **Given** 稿件质量不合格，**When** 编辑选择“退回修改”并填写意见，**Then** 稿件状态变为“待作者修改”，作者收到包含修改意见及重新提交链接的通知邮件 (标题: [ScholarFlow] 稿件修改通知: {Title})。

---

### User Story 3 - 审稿人免登录预览与评价 (Priority: P3)

审稿人通过邮件中的唯一 Token 链接直接进入系统，无需登录即可在线预览 PDF 并填写审稿意见。

**Why this priority**: 降低审稿人的参与门槛，提高评审反馈效率。

**Independent Test**: 使用包含有效 Token 的 URL 访问，系统直接展示 PDF 预览器和审稿表单。

**Acceptance Scenarios**:
1. **Given** 有效的 Token 链接，**When** 访问链接，**Then** 审稿人能看到稿件内容并提交报告。
2. **Given** 已过期或无效的 Token 链接，**When** 访问链接，**Then** 系统显示“链接已失效”提示。

---

### User Story 4 - 财务开票与上线控制 (Priority: P4)

稿件通过审核后，系统自动生成账单 PDF 并发送。只有财务确认收到款项后，编辑才能点击“上线”发布。

**Why this priority**: 确保学术出版的商业闭环和版权安全性。

**Independent Test**: 模拟稿件录入，检查是否生成账单；尝试在财务未确认时点击“上线”，验证是否被系统拦截。

**Acceptance Scenarios**:
1. **Given** 稿件审核通过，**When** 触发财务流程，**Then** 作者收到带有 PDF 附件的账单邮件。
2. **Given** 财务人员在后台手动标记“已到账”，**When** 编辑点击“上线”，**Then** 文章状态变更为“已发布”。

---

### User Story 5 - AI 自动推荐审稿人 (Priority: P5)

利用算法分析稿件内容与审稿人库的匹配度，自动推荐最合适的审稿人。

**Why this priority**: 辅助编辑决策，提高审稿人选取的科学性和速度。

**Independent Test**: 输入特定主题的稿件，系统列出匹配度得分排名前 5 的审稿人。

**Acceptance Scenarios**:
1. **Given** 稿件摘要，**When** 点击“推荐审稿人”，**Then** 返回包含匹配理由和得分的建议名单。
2. **Given** 推荐名单，**When** 编辑点击“邀请”并确认，**Then** 系统自动向该审稿人发送带有 Token 链接的邀请邮件。

## Edge Cases

- **AI 解析失败**: 当 AI 引擎无法解析 PDF 时，系统必须允许作者通过手动输入完成投稿流程。
- **财务误操作回滚**: 系统必须支持财务人员“撤销确认”已支付状态。撤销后，稿件状态必须回滚至 `pending_payment`，发布流程重新锁定，并记录审计日志。
- **审稿邀请撤销**: 在审稿人接受邀请前，系统允许编辑“撤销邀请”。撤销后该审稿人的 Token 立即失效，页面显示“邀请已撤回”。
- **AI 推荐零结果**: 若算法未发现匹配度 > 0.1 的审稿人，系统应显示“未找到推荐结果”，并提供手动搜索输入框。

## Requirements

### Functional Requirements

- **FR-001**: 系统必须支持上传最大 50MB 的 PDF 文件。
- **FR-002**: AI 解析引擎必须提取：Title, Abstract, Author Names, Email (如果存在)。
- **FR-003**: 审稿 Token 由系统自动生成随机高强度字符串，默认有效期为 14 天，并支持手动失效。
- **FR-004**: 财务账单 PDF 必须包含：订单号、金额、收款账户信息、有效期。
- **FR-005**: 稿件上线逻辑必须有严格的状态门控：[财务确认 = True] AND [主编审核 = True]。
- **FR-006**: 推荐算法必须支持基于 TF-IDF 或语义向量的相似度计算。系统在管理后台提供切换开关，允许编辑根据学科领域手动选择首选算法模型。
- **FR-007**: 系统必须记录每一份稿件的 KPI 归属人及操作时间戳。归属人必须从编辑人员列表中选择，用于统计稿件从“投稿”到“质检完成”的处理时效。
- **FR-008**: 系统必须支持主编 (Editor-in-Chief) 角色对质检后的稿件进行终审。只有终审通过且财务确认到账，稿件方可执行“上线”操作。
- **FR-009**: 系统必须为编辑主管提供一个简单的 KPI 统计看板，展示各归属人名下的稿件数量及平均质检周期。
- **FR-010**: 作者重新提交稿件后，稿件状态必须从 `returned_for_revision` 自动变更为 `submitted`。系统必须保留历史 PDF 版本记录，并允许编辑在后台进行版本比对。

### Key Entities

- **Manuscript (稿件)**: 核心实体，包含标题、文件 URL、状态（投稿、质检、评审、待缴费、已发布）。
- **Invoice (账单)**: 与稿件 1:1 关联，包含金额、支付状态、账单文件路径。
- **ReviewReport (审稿报告)**: 审稿人的评价、分数和建议。
- **User (用户)**: 包含作者、编辑、财务、审稿人（及其领域标签）。

## Success Criteria

### Measurable Outcomes

- **SC-001**: AI 自动提取字段的准确率（相比人工核对）达到 85% 以上。**[评估方式：通过随机抽样 100 篇已发表 PDF 作为基准集，对比 AI 提取字段与人工校对字段的完全匹配度]**。
- **SC-002**: 审稿人从点击链接到看到 PDF 的加载时间在 3 秒以内（50MB 以内文件）。**[评估方式：在 10Mbps 带宽环境下，从点击 URL 到首屏渲染完成的时间]**。
- **SC-003**: 严禁在财务未确认的情况下发布文章，拦截率必须为 100%。
- **SC-004**: 系统生成的 PDF 账单必须包含：项目 Logo、唯一账单号、明细金额、付款截止日期及标准法律声明。

## Assumptions

- 假设 AI 解析服务由 Python 后端提供，前端仅负责显示和校验。
- 假设财务确认过程是人工手动触发，不涉及自动银行对账接口。
- **UI 风格标准**: 参考 Frontiers 风格，具体要求：
  - 采用全宽页面布局与浅灰色背景。
  - 使用卡片式容器展示稿件信息，边框圆角 4px，带有轻微阴影。
  - 主要交互按钮 (CTA) 必须为鲜明的品牌蓝色。
  - 侧边栏导航采用简洁的线条图标，点击态显示加粗文本。