# Feature Specification: Production Pipeline Workspace (录用后生产协作闭环)

**Feature Branch**: `042-production-pipeline`  
**Created**: 2026-02-09  
**Status**: Draft  
**Input**: User description: "Implement a production pipeline workspace for accepted manuscripts: layout editor uploads galley proof, authors complete proofreading confirmation or correction list, and publication uses the approved production version."

## User Scenarios & Testing *(mandatory)*

### User Story 1 - 排版编辑提交清样 (Priority: P1)

当稿件进入录用后阶段，排版编辑需要在系统内提交可校对的清样版本，并明确版本说明，避免通过邮件散落传输文件。

**Why this priority**: 没有清样上传入口，录用后的生产流程无法正式启动，出版闭环会中断。

**Independent Test**: 将一篇录用稿件分配给排版编辑，验证其可创建一次生产轮次、上传清样并提交说明，且稿件进入“待作者校对”。

**Acceptance Scenarios**:

1. **Given** 稿件已录用且尚无进行中的生产轮次，**When** 排版编辑创建生产轮次并提交清样，**Then** 系统记录该轮次并进入待作者校对状态。
2. **Given** 稿件已有进行中的生产轮次，**When** 排版编辑尝试再次创建新轮次，**Then** 系统阻止重复创建并提示先完成当前轮次。

---

### User Story 2 - 作者提交校对结论 (Priority: P1)

作者在收到清样后，需要在系统内选择“确认无误”或“提交修正清单”，并留下可追踪的反馈记录。

**Why this priority**: 作者校对是录用到发布之间的关键质量门禁，缺失会导致发布质量和责任归属不清。

**Independent Test**: 针对待校对稿件，验证作者可查看清样并完成两种反馈路径之一，且系统记录提交时间和内容。

**Acceptance Scenarios**:

1. **Given** 作者有待处理的清样任务，**When** 作者选择“确认无误”并提交，**Then** 系统将该轮次标记为作者已确认。
2. **Given** 作者有待处理的清样任务，**When** 作者提交修正清单，**Then** 系统保存逐条修正意见并将该轮次标记为需排版修订。

---

### User Story 3 - 编辑完成发布前核准 (Priority: P2)

责任编辑需要在一个界面中查看“清样版本 + 作者反馈 + 最新处理状态”，并决定是否允许进入发布。

**Why this priority**: 没有统一核准动作会导致发布依据分散，增加误发旧版本的风险。

**Independent Test**: 在作者已确认的稿件上执行发布前核准，验证系统只允许基于已核准的生产版本进入可发布状态。

**Acceptance Scenarios**:

1. **Given** 生产轮次已完成作者确认，**When** 责任编辑执行发布前核准，**Then** 系统将该生产版本设为唯一可发布版本。
2. **Given** 作者尚未完成校对，**When** 责任编辑尝试核准发布，**Then** 系统拒绝操作并提示缺少作者校对结果。

---

### User Story 4 - 生产过程可审计回溯 (Priority: P3)

管理层和编辑部需要回看“谁在何时上传了哪个清样、作者何时反馈了什么、最终核准了哪个版本”。

**Why this priority**: 出版纠纷和质量复盘依赖完整审计链路，属于风险控制能力。

**Independent Test**: 对一篇经历完整生产流程的稿件，验证可查看完整时间线和每一步操作者信息。

**Acceptance Scenarios**:

1. **Given** 稿件完成至少一轮生产流程，**When** 编辑查看生产历史，**Then** 系统按时间顺序展示上传、反馈、核准等关键事件。

### Edge Cases

- 作者在校对截止后才提交反馈时，系统应阻止提交并标记为逾期待处理。
- 排版编辑重新上传清样后，之前未完成的作者反馈入口应自动失效，防止对旧版本继续提交意见。
- 作者提交的修正清单为空或仅包含无效内容时，系统应拒绝提交并要求有效说明。
- 稿件存在多位共同作者时，系统应明确单一“校对责任人”，避免重复或冲突提交。
- 已进入发布状态的稿件不得再开启新的生产轮次，除非先执行正式的撤回发布流程。

## Requirements *(mandatory)*

### Functional Requirements

- **FR-001**: 系统必须仅允许“已录用”的稿件进入生产协作流程。
- **FR-002**: 系统必须支持排版编辑为稿件创建生产轮次，并在同一时间最多存在一个进行中的轮次。
- **FR-003**: 系统必须要求排版编辑在提交清样时填写版本说明，确保变更原因可追踪。
- **FR-004**: 系统必须为作者提供清样查看入口，并展示当前轮次的校对截止时间与处理状态。
- **FR-005**: 作者必须能够在每个轮次中二选一提交结果：确认无误，或提交修正清单。
- **FR-006**: 系统必须在作者提交后立即锁定该轮次的作者输入，防止重复提交导致冲突。
- **FR-007**: 当作者提交修正清单时，系统必须将轮次状态变为“需排版修订”，并通知排版编辑处理。
- **FR-008**: 系统必须支持责任编辑在作者确认后执行发布前核准，并将该轮次标记为可发布依据。
- **FR-009**: 系统必须阻止未完成作者校对的稿件进入发布前核准。
- **FR-010**: 系统必须保证最终发布仅能引用“已核准的生产版本”，不得回退到作者原稿版本。
- **FR-011**: 系统必须记录生产流程关键事件（创建轮次、上传清样、作者提交、编辑核准）的操作者与时间戳。
- **FR-012**: 系统必须为不同角色提供最小权限访问：作者仅能处理自身稿件校对任务，排版编辑仅能处理被分配稿件，编辑仅能核准有权限的稿件。
- **FR-013**: 系统必须在关键节点发送站内提醒，至少覆盖“新清样待校对”“修正清单待处理”“已可发布”三类事件。
- **FR-014**: 系统必须提供生产轮次历史视图，支持按时间回看每次轮次的输入与结论。

### Key Entities *(include if feature involves data)*

- **Production Cycle**: 表示一次录用后生产轮次，包含轮次编号、当前状态、截止时间、负责角色和时间线。
- **Galley Proof**: 表示某轮次的清样文件与版本说明，是作者校对和发布核准的基础对象。
- **Proofreading Response**: 表示作者在轮次中的校对结论，包含“确认无误”或“修正清单”及提交时间。
- **Publication Approval**: 表示责任编辑对某轮次的发布前核准结果，决定是否可进入发布。
- **Production Audit Event**: 表示生产流程中的关键操作记录，用于追溯责任与过程。

### Assumptions

- 本功能范围仅覆盖“录用后到发布前”的生产协作，不扩展到正式排版软件内的编辑行为。
- 每篇稿件在任一时刻仅有一个激活的生产轮次，以降低流程复杂度。
- 默认由编辑部指定一位作者作为该轮次校对责任人。
- 校对反馈以结构化文本为主，不要求在本阶段提供复杂格式校对标注工具。

### Dependencies

- 录用决策流程已稳定输出可进入生产阶段的稿件。
- 发布门禁规则可消费“已核准生产版本”这一业务状态。
- 站内通知能力可用于发送生产阶段任务提醒。

### Out of Scope

- 财务对账和发票处理流程。
- DOI 注册及外部学术索引同步。
- 公开门户页面的学科分类与引用导出。

## Success Criteria *(mandatory)*

### Measurable Outcomes

- **SC-001**: 95% 的录用稿件在进入生产阶段后 2 个工作日内完成首版清样提交。
- **SC-002**: 90% 的作者在收到清样后 5 个自然日内完成校对反馈提交。
- **SC-003**: 100% 的发布稿件都能追溯到唯一的“已核准生产版本”。
- **SC-004**: 上线后 1 个发布周期内，因“版本混淆”导致的内部返工单量下降 80% 以上。
- **SC-005**: 在 UAT 评估中，至少 85% 的编辑认为录用后协作流程“清晰且可追踪”。
